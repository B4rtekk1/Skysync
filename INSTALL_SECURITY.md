# Instrukcje Instalacji Funkcji Bezpiecze≈Ñstwa

## üöÄ Szybka Instalacja

### 1. Zainstaluj Nowe Zale≈ºno≈õci
```bash
cd fileserver
pip install -r requirements.txt
```

### 2. Uruchom Migracjƒô Bazy Danych
```bash
python migrate_database.py
```

### 3. Sprawd≈∫ Konfiguracjƒô
Upewnij siƒô, ≈ºe masz ustawione zmienne ≈õrodowiskowe w pliku `.env`:
```bash
SECRET_KEY=your_very_secure_secret_key_here
API_KEY=your_api_key_here
BASE_URL=http://localhost:8000
```

### 4. Uruchom Serwer
```bash
uvicorn server:app --host 0.0.0.0 --port 8000
```

## üîß Szczeg√≥≈Çowa Instalacja

### Krok 1: Przygotowanie ≈örodowiska
```bash
# Utw√≥rz wirtualne ≈õrodowisko (opcjonalnie)
python -m venv venv
source venv/bin/activate  # Linux/Mac
# lub
venv\Scripts\activate  # Windows

# Zainstaluj zale≈ºno≈õci
pip install fastapi==0.104.1
pip install uvicorn==0.24.0
pip install sqlalchemy==2.0.23
pip install python-multipart==0.0.6
pip install python-jose[cryptography]==3.3.0
pip install bcrypt==4.1.2
pip install python-dotenv==1.0.0
pip install cryptography==41.0.7
```

### Krok 2: Konfiguracja Bezpiecze≈Ñstwa
Utw√≥rz plik `.env` w katalogu `fileserver`:
```bash
# Klucze bezpiecze≈Ñstwa (ZMIE≈É TE WARTO≈öCI!)
SECRET_KEY=your_super_secret_key_at_least_32_characters_long
API_KEY=your_api_key_for_client_authentication

# Konfiguracja serwera
BASE_URL=http://localhost:8000

# Opcjonalne ustawienia
MAX_LOGIN_ATTEMPTS=5
LOGIN_LOCKOUT_DURATION=15
MAX_FILE_SIZE=104857600  # 100MB w bajtach
ACCESS_TOKEN_EXPIRE_MINUTES=30
```

### Krok 3: Migracja Bazy Danych
```bash
# Uruchom skrypt migracji
python migrate_database.py
```

Oczekiwany wynik:
```
Starting database migration...
Adding column failed_login_attempts to users table...
Adding column account_locked_until to users table...
Adding column last_login to users table...
Adding column is_active to users table...
Adding column created_at to users table...
Adding column file_size to files table...
Adding column file_hash to files table...
Adding column mime_type to files table...
Adding column uploaded_at to files table...
Adding column is_encrypted to files table...
Database migration completed successfully!

Migration Summary:
- Users in database: 0
- Files in database: 0
- New security features enabled
```

### Krok 4: Testowanie Instalacji
```bash
# Uruchom serwer
uvicorn server:app --host 0.0.0.0 --port 8000 --reload

# W nowym terminalu, przetestuj endpoint bezpiecze≈Ñstwa
curl -X GET "http://localhost:8000/security/status" \
  -H "Authorization: Bearer your_token" \
  -H "API_KEY: your_api_key"
```

## üîç Weryfikacja Instalacji

### Sprawd≈∫ Logi Bezpiecze≈Ñstwa
```bash
# Sprawd≈∫ czy plik log√≥w jest tworzony
tail -f security.log
```

### Sprawd≈∫ Bazƒô Danych
```bash
# Sprawd≈∫ nowe tabele
sqlite3 server.db ".tables"
# Powinno pokazaƒá: encrypted_files, security_events, users, files, favorites, shared_files, shared_folders

# Sprawd≈∫ nowe kolumny w tabeli users
sqlite3 server.db "PRAGMA table_info(users);"
```

### Testuj Nowe Funkcje
```bash
# 1. Test WAF - powinno zablokowaƒá
curl "http://localhost:8000/login?user=admin' OR '1'='1"

# 2. Test rate limiting - powinno zablokowaƒá po 10 pr√≥bach
for i in {1..11}; do
  curl -X POST http://localhost:8000/login \
    -H "Content-Type: application/json" \
    -H "API_KEY: your_api_key" \
    -d '{"email":"test","password":"wrong"}'
done

# 3. Test szyfrowania (po zalogowaniu)
curl -X POST http://localhost:8000/encrypt_file \
  -H "Authorization: Bearer your_token" \
  -H "Content-Type: application/json" \
  -d '{"filename":"test.txt","folder_name":"user1","encryption_password":"strong_password123"}'
```

## ‚ö†Ô∏è RozwiƒÖzywanie Problem√≥w

### Problem: B≈ÇƒÖd Importu cryptography
```bash
# RozwiƒÖzanie: Zainstaluj ponownie
pip uninstall cryptography
pip install cryptography==41.0.7
```

### Problem: B≈ÇƒÖd migracji bazy danych
```bash
# RozwiƒÖzanie: Sprawd≈∫ uprawnienia
chmod 644 server.db
# lub usu≈Ñ i utw√≥rz ponownie
rm server.db
python migrate_database.py
```

### Problem: B≈ÇƒÖd SECRET_KEY
```bash
# RozwiƒÖzanie: Sprawd≈∫ plik .env
cat .env
# Upewnij siƒô, ≈ºe SECRET_KEY ma co najmniej 32 znaki
```

### Problem: B≈ÇƒÖd API_KEY
```bash
# RozwiƒÖzanie: Sprawd≈∫ nag≈Ç√≥wki ≈ºƒÖda≈Ñ
curl -H "API_KEY: your_api_key" http://localhost:8000/security/status
```

## üîí Najlepsze Praktyki Bezpiecze≈Ñstwa

### 1. Zmie≈Ñ Domy≈õlne Klucze
```bash
# Wygeneruj bezpieczny SECRET_KEY
python -c "import secrets; print(secrets.token_urlsafe(32))"

# Wygeneruj bezpieczny API_KEY
python -c "import secrets; print(secrets.token_urlsafe(16))"
```

### 2. Skonfiguruj HTTPS
```bash
# Uruchom z certyfikatem SSL
uvicorn server:app --host 0.0.0.0 --port 443 --ssl-keyfile=key.pem --ssl-certfile=cert.pem
```

### 3. Monitoruj Logi
```bash
# Ustaw rotacjƒô log√≥w
logrotate /etc/logrotate.d/security_logs
```

### 4. Regularne Backupy
```bash
# Backup bazy danych
sqlite3 server.db ".backup backup_$(date +%Y%m%d_%H%M%S).db"
```

## üìä Monitorowanie Po Instalacji

### Sprawd≈∫ Status Bezpiecze≈Ñstwa
```bash
# Endpoint dla administrator√≥w
curl -X GET "http://localhost:8000/security/status" \
  -H "Authorization: Bearer admin_token" \
  -H "API_KEY: your_api_key"
```

### Monitoruj Zdarzenia
```bash
# ≈öled≈∫ logi w czasie rzeczywistym
tail -f security.log | grep -E "(waf_blocked|failed_login|file_encrypted)"

# Sprawd≈∫ statystyki dzienne
grep "$(date +%Y-%m-%d)" security.log | wc -l
```

### Sprawd≈∫ Wydajno≈õƒá
```bash
# Monitoruj u≈ºycie CPU podczas szyfrowania
top -p $(pgrep -f "uvicorn server:app")

# Sprawd≈∫ rozmiar bazy danych
ls -lh server.db
```

## ‚úÖ Lista Kontrolna Instalacji

- [ ] Zainstalowano wszystkie zale≈ºno≈õci
- [ ] Utworzono plik `.env` z bezpiecznymi kluczami
- [ ] Uruchomiono migracjƒô bazy danych
- [ ] Przetestowano endpoint `/security/status`
- [ ] Sprawdzono logi bezpiecze≈Ñstwa
- [ ] Przetestowano WAF
- [ ] Przetestowano szyfrowanie plik√≥w
- [ ] Skonfigurowano HTTPS (opcjonalnie)
- [ ] Ustawiono monitoring log√≥w

Po wykonaniu wszystkich krok√≥w, serwer bƒôdzie mia≈Ç najwy≈ºszy poziom bezpiecze≈Ñstwa z nowymi funkcjami ochrony! 