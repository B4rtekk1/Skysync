# üõ°Ô∏è ServApp - Instrukcje Bezpiecze≈Ñstwa

## PrzeglƒÖd

Ten dokument zawiera instrukcje dotyczƒÖce wdra≈ºania i konfiguracji ulepsze≈Ñ bezpiecze≈Ñstwa dla aplikacji ServApp. Wszystkie funkcje zosta≈Çy zaprojektowane z my≈õlƒÖ o maksymalnej ochronie przed r√≥≈ºnymi typami atak√≥w.

## üöÄ Szybka Instalacja

### 1. Instalacja Zale≈ºno≈õci

```bash
# Instalacja podstawowych zale≈ºno≈õci bezpiecze≈Ñstwa
pip install -r requirements_security.txt

# Lub instalacja pojedynczych pakiet√≥w
pip install python-magic cryptography aiofiles pydantic[email]
```

### 2. Konfiguracja Zmiennych ≈örodowiskowych

Utw√≥rz lub zaktualizuj plik `.env`:

```env
# Podstawowa konfiguracja
SECRET_KEY=your-very-secure-secret-key-minimum-32-characters
API_KEY=your-secure-api-key-here
BASE_URL=http://localhost:8000

# Konfiguracja email
EMAIL=your-email@gmail.com
PASSWORD=your-app-password

# Ulepszona konfiguracja bezpiecze≈Ñstwa
ENCRYPTION_KEY=your-secure-encryption-key-32-characters
SECURITY_LOG_LEVEL=INFO
ENABLE_VIRUS_SCANNING=true
ENABLE_ENCRYPTION=true
MAX_FILE_SIZE=104857600
SESSION_TIMEOUT_MINUTES=30
RATE_LIMIT_MAX_REQUESTS=100
RATE_LIMIT_WINDOW=60
```

### 3. Uruchomienie Serwera

```bash
# Uruchomienie z ulepszonymi funkcjami bezpiecze≈Ñstwa
python server.py

# Lub z uvicorn
uvicorn server:app --host 0.0.0.0 --port 8000 --reload
```

## üîß Konfiguracja Szczeg√≥≈Çowa

### Konfiguracja Bezpiecze≈Ñstwa

Wszystkie ustawienia bezpiecze≈Ñstwa sƒÖ dostƒôpne w s≈Çowniku `SECURITY_CONFIG` w pliku `server.py`:

```python
SECURITY_CONFIG = {
    'max_request_size': 100 * 1024 * 1024,  # 100MB
    'max_files_per_upload': 10,
    'session_timeout_minutes': 30,
    'password_history_size': 5,
    'max_failed_attempts_per_hour': 10,
    'account_lockout_threshold': 5,
    'account_lockout_duration': 30,  # minutes
    'session_inactivity_timeout': 15,  # minutes
    'max_concurrent_sessions': 3,
    'file_scan_timeout': 30,  # seconds
    'encryption_key_rotation_days': 90,
    'audit_log_retention_days': 365,
    'backup_retention_days': 30,
    'max_file_name_length': 255,
    'max_folder_depth': 10,
    'rate_limit_window': 60,  # seconds
    'rate_limit_max_requests': 100,
    'csrf_protection': True,
    'xss_protection': True,
    'sql_injection_protection': True,
    'path_traversal_protection': True,
    'file_upload_validation': True,
    'content_type_validation': True,
    'virus_scanning': True,
    'encryption_at_rest': True,
    'encryption_in_transit': True,
    'session_fixation_protection': True,
    'clickjacking_protection': True,
    'mime_sniffing_protection': True,
    'referrer_policy': 'strict-origin-when-cross-origin',
    'content_security_policy': "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'",
    'permissions_policy': "geolocation=(), microphone=(), camera=()",
    'hsts_max_age': 31536000,
    'hsts_include_subdomains': True,
    'hsts_preload': True
}
```

### Konfiguracja Logowania

Logi bezpiecze≈Ñstwa sƒÖ zapisywane w pliku `security.log` z nastƒôpujƒÖcym formatem:

```
2024-01-15 10:30:00 - INFO - [192.168.1.100] [testuser] SECURITY_EVENT: {"event_type": "failed_login", "details": "Invalid password", "severity": "medium"}
```

## üß™ Testowanie Bezpiecze≈Ñstwa

### Uruchomienie Test√≥w

```bash
# Testowanie wszystkich funkcji bezpiecze≈Ñstwa
python test_security.py

# Testowanie z niestandardowymi parametrami
python test_security.py --url http://localhost:8000 --api-key your_api_key
```

### Testy Do Wykonania

1. **Rate Limiting** - Sprawdza blokowanie po przekroczeniu limit√≥w
2. **File Upload Validation** - Testuje walidacjƒô plik√≥w
3. **Path Traversal** - Sprawdza ochronƒô przed path traversal
4. **SQL Injection** - Testuje ochronƒô przed SQL injection
5. **XSS Protection** - Sprawdza ochronƒô przed XSS
6. **Password Validation** - Testuje walidacjƒô hase≈Ç
7. **File Encryption** - Sprawdza szyfrowanie plik√≥w
8. **Security Headers** - Testuje nag≈Ç√≥wki bezpiecze≈Ñstwa
9. **Admin Endpoints** - Sprawdza endpointy administracyjne
10. **Session Management** - Testuje zarzƒÖdzanie sesjami
11. **Audit Logging** - Sprawdza logowanie audytu

### Przyk≈Çady Test√≥w Rƒôcznych

```bash
# Test rate limiting
for i in {1..15}; do
  curl -X POST http://localhost:8000/login \
    -H "Content-Type: application/json" \
    -H "API_KEY: your_key" \
    -d '{"email":"test","password":"wrong"}'
done

# Test path traversal
curl "http://localhost:8000/download_file/../../../etc/passwd"

# Test SQL injection
curl "http://localhost:8000/login?user=admin' OR '1'='1"

# Test XSS
curl "http://localhost:8000/login?user=<script>alert('xss')</script>"
```

## üìä Monitorowanie

### Logi Bezpiecze≈Ñstwa

Wszystkie zdarzenia bezpiecze≈Ñstwa sƒÖ logowane w pliku `security.log`:

```bash
# PrzeglƒÖdanie log√≥w w czasie rzeczywistym
tail -f security.log

# Filtrowanie zdarze≈Ñ
grep "failed_login" security.log
grep "waf_blocked" security.log
grep "rate_limit" security.log
```

### Endpointy Monitorowania

#### `/security/status`
Zwraca status bezpiecze≈Ñstwa serwera:

```bash
curl -H "Authorization: Bearer your_token" \
     http://localhost:8000/security/status
```

#### `/security/audit_log`
PrzeglƒÖdanie log√≥w audytu:

```bash
curl -H "Authorization: Bearer your_token" \
     "http://localhost:8000/security/audit_log?limit=50&severity=high"
```

#### `/security/blocked_ips`
Lista zablokowanych adres√≥w IP:

```bash
curl -H "Authorization: Bearer your_token" \
     http://localhost:8000/security/blocked_ips
```

## üîê ZarzƒÖdzanie Bezpiecze≈Ñstwem

### Blokowanie IP

```bash
# Blokowanie adresu IP
curl -X POST http://localhost:8000/security/block_ip \
  -H "Authorization: Bearer your_token" \
  -H "Content-Type: application/json" \
  -d '{"ip_address": "192.168.1.100", "duration_minutes": 60}'
```

### Odblokowanie IP

```bash
# Odblokowanie adresu IP
curl -X POST http://localhost:8000/security/unblock_ip \
  -H "Authorization: Bearer your_token" \
  -H "Content-Type: application/json" \
  -d '{"ip_address": "192.168.1.100"}'
```

### Aktualizacja Konfiguracji

```bash
# Aktualizacja ustawie≈Ñ bezpiecze≈Ñstwa
curl -X POST http://localhost:8000/security/update_config \
  -H "Authorization: Bearer your_token" \
  -H "Content-Type: application/json" \
  -d '{
    "max_file_size": 52428800,
    "session_timeout_minutes": 60,
    "enable_virus_scanning": true
  }'
```

## üö® Reakcja na Incydenty

### Automatyczne Reakcje

1. **Blokowanie IP** - Po przekroczeniu limit√≥w rate limiting
2. **Blokowanie konta** - Po nieudanych pr√≥bach logowania
3. **Odrzucanie plik√≥w** - Pliki o niebezpiecznych rozszerzeniach
4. **Blokowanie atak√≥w** - Przez Web Application Firewall

### Rƒôczne Akcje

1. **Monitorowanie log√≥w** - Regularne sprawdzanie `security.log`
2. **Analiza wzorc√≥w** - Identyfikacja powtarzajƒÖcych siƒô atak√≥w
3. **Blokowanie IP** - Rƒôczne blokowanie podejrzanych adres√≥w
4. **Aktualizacja konfiguracji** - Dostosowanie ustawie≈Ñ bezpiecze≈Ñstwa

## üîß RozwiƒÖzywanie Problem√≥w

### Wysokie Zu≈ºycie Zasob√≥w

```bash
# Sprawdzenie log√≥w b≈Çƒôd√≥w
grep "ERROR" security.log

# Sprawdzenie liczby zablokowanych ≈ºƒÖda≈Ñ
grep "waf_blocked" security.log | wc -l

# Sprawdzenie rate limiting
grep "rate_limit" security.log | wc -l
```

### Fa≈Çszywe Alarmy

1. **Dostosowanie wzorc√≥w WAF** - Modyfikacja w `server.py`
2. **Aktualizacja limit√≥w** - Zmiana ustawie≈Ñ rate limiting
3. **Bia≈Ça lista IP** - Dodanie zaufanych adres√≥w

### Problemy z Sesjami

```bash
# Sprawdzenie wygas≈Çych sesji
curl -H "Authorization: Bearer your_token" \
     http://localhost:8000/security/cleanup_sessions

# Sprawdzenie log√≥w sesji
grep "session" security.log
```

## üìà Metryki i Raporty

### Kluczowe Wska≈∫niki

- **Liczba zablokowanych kont**
- **Liczba zablokowanych IP**
- **Liczba odrzuconych plik√≥w**
- **Liczba pr√≥b path traversal**
- **Liczba ≈ºƒÖda≈Ñ zablokowanych przez WAF**
- **Liczba zaszyfrowanych plik√≥w**

### Generowanie Raport√≥w

```bash
# Raport dzienny
python -c "
import json
from datetime import datetime, timedelta

# Analiza log√≥w z ostatnich 24 godzin
with open('security.log', 'r') as f:
    lines = f.readlines()

today = datetime.now().date()
events = []

for line in lines:
    if str(today) in line:
        events.append(line)

print(f'Zdarzenia z {today}: {len(events)}')
"
```

## üîÑ Aktualizacje i Konserwacja

### Regularne Zadania

1. **Codziennie** - Sprawdzanie log√≥w bezpiecze≈Ñstwa
2. **Cotygodniowo** - PrzeglƒÖd statystyk bezpiecze≈Ñstwa
3. **Miesiƒôcznie** - Analiza trend√≥w i aktualizacja konfiguracji
4. **Kwartalnie** - Testy penetracyjne i audyt bezpiecze≈Ñstwa

### Aktualizacje Zale≈ºno≈õci

```bash
# Sprawdzenie aktualizacji
pip list --outdated

# Aktualizacja pakiet√≥w bezpiecze≈Ñstwa
pip install --upgrade cryptography python-magic aiofiles

# Sprawdzenie podatno≈õci
safety check
```

## üìû Wsparcie

### W przypadku problem√≥w:

1. **Sprawd≈∫ logi** - Plik `security.log`
2. **Uruchom testy** - `python test_security.py`
3. **Sprawd≈∫ konfiguracjƒô** - Zmienne ≈õrodowiskowe i `SECURITY_CONFIG`
4. **Skontaktuj siƒô z zespo≈Çem** - W przypadku krytycznych problem√≥w

### Przydatne Komendy

```bash
# Sprawdzenie statusu serwera
curl http://localhost:8000/security/status

# Sprawdzenie log√≥w w czasie rzeczywistym
tail -f security.log

# Testowanie konkretnej funkcji
python test_security.py --test rate_limiting

# Backup bazy danych
sqlite3 server.db ".backup backup_$(date +%Y%m%d_%H%M%S).db"
```

## üìö Dodatkowe Zasoby

- [Dokumentacja FastAPI](https://fastapi.tiangolo.com/)
- [OWASP Top 10](https://owasp.org/www-project-top-ten/)
- [NIST Cybersecurity Framework](https://www.nist.gov/cyberframework)
- [OWASP Testing Guide](https://owasp.org/www-project-web-security-testing-guide/)

---

**Uwaga**: Ten dokument jest czƒô≈õciƒÖ systemu bezpiecze≈Ñstwa ServApp. Regularnie aktualizuj konfiguracjƒô i monitoruj logi, aby zapewniƒá maksymalnƒÖ ochronƒô aplikacji. 